<div class="mes-conges" *ngIf="!isLoading(); else loading">
  <header>
    <h1>Mes congés</h1>
    <p>Consultez vos demandes et effectuez une nouvelle demande en ligne.</p>
  </header>

  <section class="balance">
    <mat-card *ngFor="let balance of balances()">
      <h3>{{ balance.type }}</h3>
      <p>{{ balance.days }} jours consommés</p>
    </mat-card>
  </section>

  <section class="new-request">
    <h2>Demander un congé</h2>
    <form [formGroup]="leaveForm" (ngSubmit)="submitRequest()" novalidate>
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Type de congé</mat-label>
          <mat-select formControlName="typeConge">
            <mat-option value="Congé payé">Congé payé</mat-option>
            <mat-option value="RTT">RTT</mat-option>
            <mat-option value="Exceptionnel">Exceptionnel</mat-option>
            <mat-option value="Maladie">Maladie</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date de début</mat-label>
          <input matInput [matDatepicker]="startPicker" formControlName="dateDebut" />
          <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date de fin</mat-label>
          <input matInput [matDatepicker]="endPicker" formControlName="dateFin" />
          <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Motif</mat-label>
          <textarea matInput rows="3" formControlName="motif"></textarea>
        </mat-form-field>
      </div>

      <button mat-flat-button color="primary" type="submit" [disabled]="isSubmitting()">
        <mat-icon>send</mat-icon>
        Soumettre la demande
      </button>
    </form>
  </section>

  <section class="history">
    <div class="history-header">
      <h2>Historique des demandes</h2>
      <mat-form-field appearance="outline">
        <mat-label>Filtrer par statut</mat-label>
        <mat-select [value]="statusFilter()" (selectionChange)="statusFilter.set($event.value)">
          <mat-option value="ALL">Tous</mat-option>
          <mat-option value="EN_ATTENTE">En attente</mat-option>
          <mat-option value="APPROUVE">Approuvé</mat-option>
          <mat-option value="REFUSE">Refusé</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-card class="conge-card" *ngFor="let conge of filteredConges(); trackBy: trackById">
      <div class="conge-info">
        <h3>{{ conge.typeConge }}</h3>
        <p>{{ conge.dateDebut | date: 'dd MMM yyyy' }} → {{ conge.dateFin | date: 'dd MMM yyyy' }}</p>
        <p>{{ conge.nombreJours }} jours • {{ conge.motif }}</p>
      </div>
      <mat-chip-set>
        <mat-chip [class.pending]="conge.statut === 'EN_ATTENTE'" [class.approved]="conge.statut === 'APPROUVE'" [class.refused]="conge.statut === 'REFUSE'">
          {{ conge.statut | titlecase }}
        </mat-chip>
      </mat-chip-set>
    </mat-card>
  </section>
</div>

<ng-template #loading>
  <div class="loading-state">
    <mat-progress-spinner diameter="48" mode="indeterminate"></mat-progress-spinner>
    <p>Chargement de vos congés...</p>
  </div>
</ng-template>

<div class="error-banner" *ngIf="error()">
  <mat-icon>error_outline</mat-icon>
  {{ error() }}
</div>
