<div class="page-header">
  <h1>Suivi de la paie</h1>
  <p>Données consolidées depuis le microservice paie.</p>
</div>

<mat-card class="filters-card">
  <div class="filters-grid">
    <mat-form-field appearance="outline">
      <mat-label>Département</mat-label>
      <mat-select [formControl]="departmentControl">
        <mat-option value="ALL">Tous les départements</mat-option>
        <mat-option *ngFor="let department of departments()" [value]="department.id">
          {{ department.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-stroked-button color="primary" type="button" (click)="refresh()">
      <mat-icon>refresh</mat-icon>
      Actualiser
    </button>
  </div>
</mat-card>

<mat-card class="table-card">
  <div class="loading-state" *ngIf="isLoading(); else tableBlock">
    <mat-progress-spinner diameter="36" mode="indeterminate"></mat-progress-spinner>
    <span>Chargement des salaires...</span>
  </div>

  <ng-template #tableBlock>
    <table mat-table [dataSource]="filteredSalaries()" class="paie-table" *ngIf="filteredSalaries().length; else emptyState">
      <ng-container matColumnDef="employee">
        <th mat-header-cell *matHeaderCellDef>Collaborateur</th>
        <td mat-cell *matCellDef="let salaire">
          <div class="employee">
            <p class="name">{{ salaire.employeeName }}</p>
            <p class="meta">ID #{{ salaire.employeeId }}</p>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="department">
        <th mat-header-cell *matHeaderCellDef>Département</th>
        <td mat-cell *matCellDef="let salaire">{{ salaire.departmentName || '—' }}</td>
      </ng-container>

      <ng-container matColumnDef="salaireBase">
        <th mat-header-cell *matHeaderCellDef>Salaire de base</th>
        <td mat-cell *matCellDef="let salaire">{{ salaire.salaireBase | number: '1.0-0' }} FCFA</td>
      </ng-container>

      <ng-container matColumnDef="primes">
        <th mat-header-cell *matHeaderCellDef>Primes</th>
        <td mat-cell *matCellDef="let salaire">{{ salaire.primes | number: '1.0-0' }} FCFA</td>
      </ng-container>

      <ng-container matColumnDef="deductions">
        <th mat-header-cell *matHeaderCellDef>Déductions</th>
        <td mat-cell *matCellDef="let salaire">{{ salaire.deductions | number: '1.0-0' }} FCFA</td>
      </ng-container>

      <ng-container matColumnDef="net">
        <th mat-header-cell *matHeaderCellDef>Net à payer</th>
        <td mat-cell *matCellDef="let salaire" class="net-cell">{{ salaire.salaireNet | number: '1.0-0' }} FCFA</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let salaire">
          <button mat-icon-button color="primary" type="button" (click)="generateFiche(salaire)">
            <mat-icon>receipt_long</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackById"></tr>
    </table>
  </ng-template>
</mat-card>

<ng-template #emptyState>
  <div class="empty-state">
    <mat-icon>payments</mat-icon>
    <p>Aucun salaire enregistré pour ce filtre.</p>
  </div>
</ng-template>

<div class="error-banner" *ngIf="error()">
  <mat-icon>error_outline</mat-icon>
  {{ error() }}
</div>
